<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

    	/*
    	**************************************
    	TO DO
    	**************************************
	- Show the user new tweets somehow
	  - Automatically as created?
  	  - Click on a button?
	- Display the timestamps of when the tweets were created
	- Design interface 
	- Allow users to click a username to see that user's timeline

	
	users = [username1, username2, ..., usernamen]
	streams = {users: {username1: username1's tweets,
			   username2: username2's tweets,
			   ...				
			   usernamen: usernamen's tweets},
		   home:  [tweet1, tweet2, tweet3]}	
    	*/


    	/*
    	**************************************
    	QUESTIONS
    	**************************************
	
	- How much interface design is necessary? 
	- Why is my function declaration only working within the ready?
	--- I didn't have this problem with chatbuilder	
	- Why is the click-on-username not working after getting new tweets using the button?
	- Clicking on username - does the text need to be in the same format?

    	*/


    	/*
    	**************************************
    	FUNCTION DECLARATIONS
    	**************************************
    	*/

/*
	// this isn't working as a function declaration 
	// only from within the ready block
    	var fetchTweets = function() {
    	  var index = streams.home.length - 1;
	  $body.append(index);
    	  while(index >= 0){
    	    var tweet = streams.home[index];
	    //$user = '<button class='user'> + tweet.user + '</button>';
    	    $tweet.text('@' + tweet.user + ': ' + tweet.message);
    	    $tweet.appendTo($body);
    	    index -= 1;
   	   }
	};
*/
    	/*
    	**************************************
    	BODY OF SCRIPT
    	**************************************
    	*/
    

    	$(document).ready(function(){

      	  var $body = $('body');
	/*
    	  //$body.html('');
    	  //$body.append('<h2>TWITTLER!</h2>');
	  //$body.append("<div id='fetching'>");
    	  //$body.append('<button>Get New Tweets</button>');
 	  //$body.append('</div>');
    	  //$body.append('<p></p>');
      	*/

	  var currentIndex = 0;
	  var $alltweets = $('<div></div>');
	  $alltweets.appendTo($body);

	  var fetchTweets = function() {
      	    var index = streams.home.length - 1;
      	    while(index > currentIndex){
              var tweet = streams.home[index];
              var $tweet = $("<div class='tweet'></div>");
	      var $username = $("<button class='link'>" + tweet.user + "</button>");
	      $username.css({'background': 'none', 'border':'none'});
              //$tweet.text('@' + tweet.user + ': ' + tweet.message);
              $tweet.append('@'); 
              $tweet.append($username);
              $tweet.append(': ' + tweet.message + ' ' + tweet.created_at);
              $tweet.prependTo($alltweets);
              index -= 1;
	    }
	    currentIndex = streams.home.length - 1;;
	  }

	  fetchTweets();
	      	
	  //$('button').on('click', function(event) {
	  $('#fetching').on('click', 'button', function(event) {
	     $alltweets.prepend('<p>-----</p>');	     
	     fetchTweets();
      	  });

	  $('.tweet').on('click', 'button', function(event) {
	     $thisuser = $(this).text();
	     $alltweets.prepend('<p>-----</p>');
	     for (var key in streams.users[$thisuser]) {
	        $alltweets.prepend('<div>' + streams.users[$thisuser][key]["message"] + ' ' + streams.users[$thisuser][key]["created_at"] + '</div>');
	     }
	     $alltweets.prepend("<div>" + $thisuser + "'s messages:<div>");	    
      	  });


    	});
    
    </script>

	<h2>TWITTLER!</h2>
	<div id='fetching'>
		<button>Get New Tweets</button>
	</div>
	<p></p>

  </body>
</html>
