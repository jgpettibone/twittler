<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

    	/*
    	**************************************
    	TO DO
    	**************************************
	- Show the user new tweets somehow
	  - Automatically as created?
  	  - Click on a button?
	- Display the timestamps of when the tweets were created
	- Design interface 
	- Allow users to click a username to see that user's timeline

	
	users = [username1, username2, ..., usernamen]
	streams = {users: {username1: username1's tweets,
			   username2: username2's tweets,
			   ...				
			   usernamen: usernamen's tweets},
		   home:  [tweet1, tweet2, tweet3]}	
    	*/


    	/*
    	**************************************
    	QUESTIONS
    	**************************************
	
	- How much interface design is necessary? 
	- Why is the click-on-username not working after getting new tweets using 
	  the button?
	- Clicking on username - does the text need to be in the same format?

    	*/


    	/*
    	**************************************
    	FUNCTION DECLARATIONS
    	**************************************
    	*/

	var fetchTweets = function(currentIndex) {
	  var index = streams.home.length - 1;
	  while(index >= currentIndex) {
	    var tweet = streams.home[index];
	    var $tweet = $("<div class='tweet'></div>");
	    var $username = $("<button class='link'>" + tweet.user + "</button>");
	    $username.css({'background': 'none', 'border':'none'});
            $tweet.append('@'); 
            $tweet.append($username);
            $tweet.append(': ' + tweet.message + ' ' + tweet.created_at);
            $tweet.prependTo($('.all-tweets'));
            index -= 1;
	  }
	  return currentIndex = streams.home.length - 1;
        }

	var testFun = function() {
	  alert("Hello");
	}


    	/*
    	**************************************
    	BODY OF SCRIPT
    	**************************************
    	*/
    

    	$('document').ready(function(){

      	  var $body = $('body');

	  var currentIndex = 0;
	  var $alltweets = $("<div class='all-tweets'></div>");
	  $alltweets.appendTo($body);

	  currentIndex = fetchTweets(currentIndex);
	      	
	  $('#fetching').on('click', 'button', function() {
	     $('.all-tweets').prepend('<p>-----</p>');	     
	     currentIndex = fetchTweets(currentIndex);
          });


	  $('.tweet').on('click', 'button', function() {
	     $thisuser = $(this).text();
	     $('.all-tweets').prepend('<p>-----</p>');
	     for (var key in streams.users[$thisuser]) {
	        $('.all-tweets').prepend('<div>' + streams.users[$thisuser][key]["message"] + 
		' ' + streams.users[$thisuser][key]["created_at"] + '</div>');
	     }
	     $('.all-tweets').prepend("<div>" + $thisuser + "'s messages:<div>");	    
      	  });


    	});
    
    </script>

	<h2>TWITTLER!</h2>
	<div id='fetching'>
	  <button>Get New Tweets</button>
	</div>
	<p></p>
	
  </body>
</html>
